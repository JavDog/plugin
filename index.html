<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obtener Coordenadas</title>
</head>
<body>
    <h1>Obtener Coordenadas</h1>
    <button onclick="obtenerCoordenadas()">Obtener Coordenadas</button>

    <script>
    function getParameterByName(name) {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
    }

    function getcitaid(url, name) {
        name = name.replace(/[[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(url);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    function obtenerCoordenadas() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                position => {
                    const { latitude, longitude } = position.coords;
                    const timestamp = new Date().toISOString();

                    // Obtener los parámetros de la URL
                    const backURL = decodeURIComponent(getParameterByName('backUrl'));
                    const aidValue = getcitaid(getParameterByName('backUrl'), 'aid');

                    // Mostrar los datos en un alert
                    alert(`Datos obtenidos:
                        \nLatitud: ${latitude}
                        \nLongitud: ${longitude}
                        \nTimestamp: ${timestamp}
                        \nbackURL: ${backURL}
                        \nID de cita: ${aidValue}`);

                    console.log('Datos obtenidos:', {
                        latitude,
                        longitude,
                        timestamp,
                        aidValue,
                        backURL
                    });
                },
                error => {
                    console.error('Error obteniendo la ubicación:', error);
                    alert('Error obteniendo la ubicación. Verifica los permisos de geolocalización.');
                }
            );
        } else {
            alert('La geolocalización no está soportada en este navegador.');
        }
    }
    </script>
</body>
</html>

