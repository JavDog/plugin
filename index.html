<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obtener Coordenadas</title>
</head>
<body>
    <h1>Obtener Coordenadas</h1>
    <button onclick="obtenerCoordenadas()">Obtener Coordenadas</button>

    <script>
    function obtenerCoordenadas() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            const { latitude, longitude } = position.coords;
            const timestamp = new Date().toISOString();

            // Obtener los parámetros de la URL
            const backURL = decodeURIComponent(getParameterByName('backUrl'));
            const aidValue = getParameterByName2(backURL, 'aid');
            const nombre = getParameterByName('Usuario'); // Obtener nombre del usuario
            const recursoPrincipalId = getParameterByName('Recurso principal'); // Obtener ID de recurso principal

            // Mostrar los datos en un alert
            alert(`Datos obtenidos:
              \nLatitud: ${latitude}
              \nLongitud: ${longitude}
              \nTimestamp: ${timestamp}
              \nTu nombre: ${nombre}
              \nID recurso principal: ${recursoPrincipalId}
              \nbackURL: ${backURL}
              \nID de cita: ${aidValue}`);

            console.log('Datos obtenidos:', {
              latitude,
              longitude,
              timestamp,
              nombre,
              recursoPrincipalId,
              aidValue,
              backURL
            });
          },
          error => {
            console.error('Error obteniendo la ubicación:', error);
            alert('Error obteniendo la ubicación. Verifica los permisos de geolocalización.');
          }
        );
      } else {
        alert('La geolocalización no está soportada en este navegador.');
      }
    }

    function getParameterByName(name) {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
    }

    function getParameterByName2(url, name) {
        name = name.replace(/[[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(url);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
    </script>
</body>
</html>
